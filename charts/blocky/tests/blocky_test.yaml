suite: test blocky
values:
  - ./values/required-values.yaml
templates:
  - common.yaml
tests:
  - it: should create deployment, service and configmap
    asserts:
      - hasDocuments:
          count: 3

  - it: should create a deployment with correct specifications
    documentIndex: 1
    asserts:
      - isKind:
          of: Deployment

  - it: should create a service with correct specifications
    documentIndex: 2
    asserts:
      - isKind:
          of: Service
      - equal:
          path: spec.type
          value: LoadBalancer
      - equal:
          path: spec.ports[0].port
          value: 53
      - equal:
          path: spec.ports[0].protocol
          value: TCP
      - equal:
          path: spec.ports[1].port
          value: 53
      - equal:
          path: spec.ports[1].protocol
          value: UDP
      - equal:
          path: spec.ports[2].port
          value: 4000

  - it: should create a configmap with correct specifications
    documentIndex: 0
    asserts:
      - isKind:
          of: ConfigMap
      - equal:
          path: data["config.yml"]
          value: |
            upstream:
              default:
                - 1.1.1.1
                - 8.8.8.8
            blocking:
              blackLists:
                ads:
                  - https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
              clientGroupsBlock:
                default:
                  - ads
            port: 53
            httpPort: 4000
            caching:
              minTime: 5m
              maxTime: 30m
